C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil C51\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg51.h"                       //´ËÎÄ¼þÖÐ¶¨ÒåÁËµ¥Æ¬»úµÄÒ»Ð©ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷
   2          #include "lcd.h"
   3          #include "key.h"
   4          #include "math.h"
   5          #include "string.h"
   6          #include "stdio.h"
   7          
   8          #define u8  unsigned char
   9          #define u16 unsigned int
  10          
  11          //°´¼üÌØÊâ·ûºÅÖµ
  12          #define add 13    // +
  13          #define sub 16    // -
  14          #define mul 19    // *
  15          #define div 22    // /
  16          #define pot 10    // .
  17          #define equ 12    // =
  18          #define fuh 11    //¸ºÊý
  19          #define clr 14    //Çå³ý
  20          
  21          #define MAXN 20
  22          
  23          #define max(a, b) ((a) > (b) ? (a) : (b))
  24          
  25          sbit beep=P1^0;
  26          
  27          void LCD_ShowStr(char addr,char * str);
  28          
  29          void delay(u16  t)     //ÑÓÊ±º¯Êý
  30          {
  31   1              while(t--);
  32   1      }
  33          
  34          
  35          //×î´ó9 9999 9999 9999 
  36          u8  data0[16]={0};
  37          u8  data1[16]={0};
  38          
  39          u8  show0[16]={0};
  40          u8  show1[16]={0};
  41          
  42          
  43          char com(u8 *a1,u8 *b1)    //a1>b1 return 1   a1=b1 return 0 a1<b1 return -1
  44          {
  45   1                      u8 len0;
  46   1                      u8 len1; 
  47   1                      int i=0;
  48   1                      len0 = strlen(a1);
  49   1                      len1 = strlen(b1);
  50   1          if(len0>len1){ return 1;}
  51   1          else if(len0==len1)
  52   1                              { 
  53   2             while(a1[i]==b1[i]&&i<len1)
  54   2                                       {
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 2   

  55   3                  i++;
  56   3               }
  57   2             if(i==len1) return 0;
  58   2             else if(a1[i]>b1[i]) return 1;
  59   2             else return -1;
  60   2          }
  61   1          else return -1;
  62   1      
  63   1      }
  64          
  65          
  66          void addx(u8 *s1,u8 *s2,u8 out[]) 
  67          {
  68   1              char i,j=0;
  69   1              char an1[MAXN]=0;
  70   1        char an2[MAXN]=0;
  71   1              
  72   1              int len1=strlen(s1);
  73   1              int len2=strlen(s2);
  74   1              
  75   1        for(i=len1-1;i>=0;i--) an1[j++]=s1[i]-'0';     
  76   1              j=0;
  77   1        for(i=len2-1;i>=0;i--) an2[j++]=s2[i]-'0';    
  78   1        j=0;
  79   1              for(i=0;i<max(len1,len2)+1;i++)
  80   1              {
  81   2                      an1[i]+=an2[i];
  82   2                      if(an1[i]>=10)
  83   2                              {
  84   3                                      an1[i]-=10;
  85   3                                      an1[i+1]++;
  86   3                      }
  87   2                      an1[i]+='0';
  88   2              }
  89   1              i=strlen(an1)-1;   
  90   1              while(an1[i]=='0')i--;    //³ýÈ¥Ê×Î»0
  91   1              memset(out,0,MAXN);
  92   1              for(;i>=0;i--)
  93   1              {
  94   2                      out[j]=an1[i];
  95   2                      j++;
  96   2              }
  97   1              
  98   1      }
  99          
 100          void subx(u8 *s1,u8 *s2,u8 out[]) 
 101          {
 102   1              char i,j=0;
 103   1              char an1[MAXN]=0;
 104   1        char an2[MAXN]=0;
 105   1      
 106   1              int len1=strlen(s1);
 107   1              int len2=strlen(s2);
 108   1              
 109   1        for(i=len1-1;i>=0;i--) an1[j++]=s1[i]-'0';     
 110   1              j=0;
 111   1        for(i=len2-1;i>=0;i--) an2[j++]=s2[i]-'0';    
 112   1        j=0;
 113   1              for(i=0;i<max(len1,len2);i++)
 114   1              {
 115   2          an1[i]-=an2[i];
 116   2          if(an1[i]<0)
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 3   

 117   2                              {
 118   3              an1[i]+=10;
 119   3              an1[i+1]--;
 120   3            }
 121   2                              an1[i]+='0';
 122   2                      }
 123   1              i=strlen(an1)-1;   
 124   1              while(an1[i]=='0')i--;    //³ýÈ¥Ê×Î»0
 125   1              memset(out,0,MAXN);
 126   1              for(;i>=0;i--)
 127   1              {
 128   2                      out[j]=an1[i];
 129   2                      j++;
 130   2              }
 131   1      }
 132          
 133          void mulx(u8 *s1,u8 *s2,u8 out[])
 134          {
 135   1              u16 c[40]=0;
 136   1              char an1[MAXN]=0;
 137   1        char an2[MAXN]=0;
 138   1              int len1=strlen(s1);
 139   1              int len2=strlen(s2);
 140   1        int len=len1+len2;
 141   1              char i,j=0;
 142   1              
 143   1              for(i=len1-1;i>=0;i--) an1[j++]=s1[i]-'0';     
 144   1              j=0;
 145   1        for(i=len2-1;i>=0;i--) an2[j++]=s2[i]-'0';    
 146   1      
 147   1                      for(i=0;i<len1;i++)
 148   1              {
 149   2                      for(j=0;j<len2;j++)
 150   2                              c[i+j]+=an1[i]*an2[j];   
 151   2              }
 152   1              for(i=0;i<len;i++)
 153   1              {    
 154   2                              if(c[i]>=10)
 155   2                              {
 156   3                                      c[i+1]+=c[i]/10;
 157   3                                      c[i]%=10;
 158   3                              }
 159   2                              c[i]+='0';
 160   2                      }  
 161   1              j=0;
 162   1              i=len-1;   
 163   1              if(c[i]=='0')i--;    //³ýÈ¥Ê×Î»0
 164   1              for(;i>=0;i--)
 165   1              {
 166   2                      out[j]=c[i];
 167   2                      j++;
 168   2              }
 169   1                      
 170   1      }
 171          
 172          
 173          void divx(u8 *s1,u8 *s2,u8 out1[])
 174          {
 175   1              u8 i,j;
 176   1               char an1[MAXN]=0;
 177   1         char an2[MAXN]=0;
 178   1               char an3[MAXN]=0;
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 4   

 179   1               char an4[MAXN]=0;
 180   1                       
 181   1               int len,len1,len2;
 182   1         if(com(s1,s2)==0){
 183   2              out1[0]='1';
 184   2         }
 185   1         else if(com(s1,s2)<0){
 186   2                          len=strlen(s1);
 187   2               out1[0]='0';
 188   2         }
 189   1         else
 190   1              {       
 191   2                         i=0;while(s1[i]=='0')i++;j=0;              //³ýÈ¥Ê×Î»0
 192   2                               for(;i<strlen(s1);i++)an1[j++]=s1[i];
 193   2                         
 194   2                               while(com(an1,s2)>=0)
 195   2                                       {
 196   3                                                memset(an2,0,MAXN);
 197   3                                                i=0;while(s2[i]=='0')i++;j=0;             //³ýÈ¥Ê×Î»0
 198   3                                                for(;i<strlen(s2);i++)an2[j++]=s2[i];
 199   3                                                len1=strlen(an1)-strlen(an2)-1;
 200   3                                                len2=strlen(an2);
 201   3                                                      for(i=0;i<len1;i++)an2[len2+i]='0';                             
 202   3                                                while(com(an1,an2)>=0)
 203   3                                                      {                                                
 204   4                                                              subx(an1,an2,an1);
 205   4                                                              addx(an3,"1",an3);      
 206   4                                                      }
 207   3                                                      len2=strlen(an3);
 208   3                                                      for(i=0;i<len1;i++)an3[len2+i]='0';                                                     
 209   3                  addx(an4,an3,an4);
 210   3                                                      memset(an3,0,MAXN);
 211   3               } 
 212   2      
 213   2                              len=strlen(an4);
 214   2                              for(i=0;i<len;i++)out1[i]=an4[i];
 215   2         }
 216   1      }
 217          
 218          
 219          
 220          void dat_add(u8 symb0,u8 pot0,u8 s0[],u8 symb1,u8 pot1,u8 s1[],u8 out[])       //·ûºÅ£¬Ð¡ÊýÎ»Êý£¬Êý¾Ý×Ö·û´
             -®   symb=0 ÎªÕýÊý ·´Ö®Îª¸ºÊý
 221          {
 222   1              
 223   1              char i;
 224   1              u8 len;
 225   1              u8 sout[MAXN]=0;
 226   1              u8 sout1[MAXN]=0;
 227   1              if(symb0 == symb1)
 228   1              {
 229   2                      if(pot0==0 && pot1==0)
 230   2                      {
 231   3                              addx(s0,s1,sout1);
 232   3                      }
 233   2                      else if(pot0>=pot1)
 234   2                      {
 235   3                              len = strlen(s1);
 236   3                              for(i=0;i<pot0-pot1;i++) s1[len+i] = '0';                      //Ð¡Êýµã¶ÔÆë
 237   3                              addx(s0,s1,sout);
 238   3                              
 239   3                              len = strlen(sout); 
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 5   

 240   3                      
 241   3                              for(i=0;i<len-pot0;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 242   3                              sout1[len-pot0]='.';                                       //Ìí¼ÓÐ¡Êýµã
 243   3                              for(i=len-pot0;i<len;i++)sout1[i+1]=sout[i];                //Ð¡ÊýµãºóµÄÊý
 244   3                      }
 245   2                      else if(pot1>pot0)
 246   2                      {
 247   3                              len = strlen(s0);
 248   3                              for(i=0;i<pot1-pot0;i++) s0[len+i] = '0';                      //Ð¡Êýµã¶ÔÆë
 249   3                              addx(s0,s1,sout);
 250   3                              
 251   3                              len = strlen(sout);                                     
 252   3                              for(i=0;i<len-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 253   3                              sout1[len-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 254   3                              for(i=len-pot1;i<len;i++)sout1[i+1]=sout[i];                //Ð¡ÊýµãºóµÄÊý
 255   3                      }
 256   2                      
 257   2                      len = strlen(sout1);
 258   2                      if(symb0 == 1)
 259   2                      {
 260   3                              out[0]='-';                                                //Ìí¼Ó¸ººÅ
 261   3                              for(i=0;i<len;i++) out[i+1]=sout1[i];
 262   3                      }
 263   2                      else for(i=0;i<len;i++) out[i]=sout1[i];
 264   2              }
 265   1              
 266   1              else if(symb0>symb1)  //µÚÒ»¸öÎª¸ºÊý
 267   1                      {
 268   2                              if(pot0==0 && pot1==0)
 269   2                              {
 270   3                                              if(com(s0,s1)==1)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 271   3                                              {
 272   4                                                      subx(s0,s1,sout1);
 273   4                                                      len = strlen(sout1);    
 274   4                                                      out[0]='-';   
 275   4                                                      for(i=0;i<len;i++) out[i+1]=sout1[i];
 276   4                                                      
 277   4                                              }
 278   3                                              
 279   3                                              else if(com(s0,s1)<=0)
 280   3                                              {
 281   4                                                      subx(s1,s0,sout1);
 282   4                                                      len = strlen(sout1);
 283   4                                                      for(i=0;i<len;i++) out[i]=sout1[i];
 284   4                                              }
 285   3                                      }
 286   2                              
 287   2                              
 288   2                              
 289   2                              else if(pot0>=pot1)
 290   2                              {
 291   3                                      len = strlen(s1);
 292   3                          for(i=0;i<pot0-pot1;i++) s1[len+i] = '0';                  //Ð¡Êýµã¶ÔÆë
 293   3                                      if(com(s0,s1)==1)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 294   3                                              {
 295   4                                                      subx(s0,s1,sout);
 296   4                                                      len = strlen(sout); 
 297   4                      
 298   4                                                      for(i=0;i<len-pot0;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 299   4                                                      sout1[len-pot0]='.';                                       //Ìí¼ÓÐ¡Êýµã
 300   4                                                      for(i=len-pot0;i<len;i++)sout1[i+1]=sout[i];    
 301   4                                                      
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 6   

 302   4                                                      len = strlen(sout1); 
 303   4                                                      out[0]='-';   
 304   4                                                      for(i=0;i<len;i++) out[i+1]=sout1[i];
 305   4                                              }
 306   3                                              else if(com(s0,s1)<=0)
 307   3                                              {
 308   4                                                      subx(s1,s0,sout);
 309   4                                                      len = strlen(sout);
 310   4                                                      
 311   4                                                      for(i=0;i<len-pot0;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 312   4                                                      sout1[len-pot0]='.';                                       //Ìí¼ÓÐ¡Êýµã
 313   4                                                      for(i=len-pot0;i<len;i++)sout1[i+1]=sout[i];
 314   4                                                      
 315   4                                                      len = strlen(sout1);
 316   4                                                      for(i=0;i<len;i++) out[i]=sout1[i];
 317   4                                              }
 318   3                              }
 319   2                              
 320   2                                      else if(pot0<pot1)
 321   2                              {
 322   3                                      len = strlen(s0);
 323   3                          for(i=0;i<pot1-pot0;i++) s0[len+i] = '0';                  //Ð¡Êýµã¶ÔÆë
 324   3                                      if(com(s0,s1)==1)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 325   3                                              {
 326   4                                                      subx(s0,s1,sout);
 327   4                                                      len = strlen(sout); 
 328   4                      
 329   4                                                      for(i=0;i<len-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 330   4                                                      sout1[len-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 331   4                                                      for(i=len-pot1;i<len;i++)sout1[i+1]=sout[i];    
 332   4                                                      
 333   4                                                      len = strlen(sout1); 
 334   4                                                      out[0]='-';   
 335   4                                                      for(i=0;i<len;i++) out[i+1]=sout1[i];
 336   4                                              }
 337   3                                              else if(com(s0,s1)<=0)
 338   3                                              {
 339   4                                                      subx(s1,s0,sout);
 340   4                                                      len = strlen(sout);
 341   4                                                      
 342   4                                                      for(i=0;i<len-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 343   4                                                      sout1[len-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 344   4                                                      for(i=len-pot1;i<len;i++)sout1[i+1]=sout[i];
 345   4                                                      
 346   4                                                      len = strlen(sout1);
 347   4                                                      for(i=0;i<len;i++) out[i]=sout1[i];
 348   4                                              }
 349   3                              }
 350   2      
 351   2                      }
 352   1                      
 353   1              else if(symb0<symb1)  //µÚ2¸öÎª¸ºÊý
 354   1                      {
 355   2                              if(pot0==0 && pot1==0)
 356   2                              {
 357   3                                      if(com(s0,s1)>=0)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 358   3                                      {
 359   4                                              subx(s0,s1,sout1);
 360   4                                              len = strlen(sout1);
 361   4                                              for(i=0;i<len;i++) out[i]=sout1[i];
 362   4                                      }
 363   3                                      else if(com(s0,s1)==-1)
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 7   

 364   3                                      {
 365   4                                              subx(s1,s0,sout1);
 366   4                                              len = strlen(sout1);
 367   4                                              out[0]='-';   
 368   4                                              for(i=0;i<len;i++) out[i+1]=sout1[i];                                   
 369   4                                      }
 370   3                              }
 371   2                              
 372   2                                      
 373   2                              else if(pot0>=pot1)
 374   2                              {
 375   3                                      len = strlen(s1);
 376   3                          for(i=0;i<pot0-pot1;i++) s1[len+i] = '0';                  //Ð¡Êýµã¶ÔÆë
 377   3                                      if(com(s0,s1)>=0)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 378   3                                              {
 379   4                                                      subx(s0,s1,sout);
 380   4                                                      len = strlen(sout); 
 381   4                      
 382   4                                                      for(i=0;i<len-pot0;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 383   4                                                      sout1[len-pot0]='.';                                       //Ìí¼ÓÐ¡Êýµã
 384   4                                                      for(i=len-pot0;i<len;i++)sout1[i+1]=sout[i];    
 385   4                                                      
 386   4                                                      len = strlen(sout1);  
 387   4                                                      for(i=0;i<len;i++) out[i]=sout1[i];
 388   4                                              }
 389   3                                              else if(com(s0,s1)==-1)
 390   3                                              {
 391   4                                                      subx(s1,s0,sout);
 392   4                                                      len = strlen(sout);
 393   4                                                      
 394   4                                                      for(i=0;i<len-pot0;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 395   4                                                      sout1[len-pot0]='.';                                       //Ìí¼ÓÐ¡Êýµã
 396   4                                                      for(i=len-pot0;i<len;i++)sout1[i+1]=sout[i];
 397   4                                                      
 398   4                                                      len = strlen(sout1);
 399   4                                                      out[0]='-';
 400   4                                                      for(i=0;i<len;i++) out[i+1]=sout1[i];
 401   4                                              }
 402   3                              }
 403   2                              
 404   2                                      else if(pot0<pot1)
 405   2                              {
 406   3                                      len = strlen(s0);
 407   3                          for(i=0;i<pot1-pot0;i++) s0[len+i] = '0';                  //Ð¡Êýµã¶ÔÆë
 408   3                                      if(com(s0,s1)==1)         //µÚÒ»¸öµÄÊýÖµ´óÓÚµÚ¶þ¸ö
 409   3                                              {
 410   4                                                      subx(s0,s1,sout);
 411   4                                                      len = strlen(sout); 
 412   4                      
 413   4                                                      for(i=0;i<len-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 414   4                                                      sout1[len-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 415   4                                                      for(i=len-pot1;i<len;i++)sout1[i+1]=sout[i];    
 416   4                                                      
 417   4                                                      len = strlen(sout1); 
 418   4                                                
 419   4                                                      for(i=0;i<len;i++) out[i]=sout1[i];
 420   4                                              }
 421   3                                              else if(com(s0,s1)<=0)
 422   3                                              {
 423   4                                                      subx(s1,s0,sout);
 424   4                                                      len = strlen(sout);
 425   4                                                      
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 8   

 426   4                                                      for(i=0;i<len-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 427   4                                                      sout1[len-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 428   4                                                      for(i=len-pot1;i<len;i++)sout1[i+1]=sout[i];
 429   4                                                      
 430   4                                                      len = strlen(sout1);
 431   4                                                      out[0]='-'; 
 432   4                                                      for(i=0;i<len;i++) out[i+1]=sout1[i];
 433   4                                              }
 434   3                              }
 435   2                              
 436   2                              
 437   2                      }
 438   1      }
 439          
 440          
 441          void dat_sub(u8 symb0,u8 pot0,u8 s0[],u8 symb1,u8 pot1,u8 s1[],u8 out[])       //·ûºÅ£¬Ð¡ÊýÎ»Êý£¬Êý¾Ý×Ö·û´
             -®   symb=0 ÎªÕýÊý ·´Ö®Îª¸ºÊý  
 442          {
 443   1      //      //////////////////////////////////////////
 444   1      //      
 445   1      //      //  a - b = a + -b                  //¼õ·¨µ÷ÓÃ¼Ó·¨¶¨ÂÉ
 446   1      //      
 447   1      //      /////////////////////////////////////////
 448   1              dat_add(symb0,pot0,s0,1-symb1,pot1,s1,out);
 449   1      }
 450          
 451          void dat_mul(u8 symb0,u8 pot0,u8 s0[],u8 symb1,u8 pot1,u8 s1[],u8 out[])       //·ûºÅ£¬Ð¡ÊýÎ»Êý£¬Êý¾Ý×Ö·û´
             -®   symb=0 ÎªÕýÊý ·´Ö®Îª¸ºÊý  
 452          {
 453   1              char i;
 454   1              u8 len;
 455   1              u8 sout[MAXN*2]=0;
 456   1              u8 sout1[MAXN*2]=0;
 457   1              
 458   1                      if(pot0==0 && pot1==0)
 459   1                      {
 460   2                              mulx(s0,s1,sout1);
 461   2                      }
 462   1                      else
 463   1                      {
 464   2                              mulx(s0,s1,sout);
 465   2                              len = strlen(sout);
 466   2      
 467   2                              for(i=0;i<len-pot0-pot1;i++)sout1[i]=sout[i];                       //Ð¡ÊýµãÇ°µÄÊý
 468   2                              sout1[len-pot0-pot1]='.';                                       //Ìí¼ÓÐ¡Êýµã
 469   2                              for(i=len-pot0-pot1;i<len;i++)sout1[i+1]=sout[i];                //Ð¡ÊýµãºóµÄÊý
 470   2                              
 471   2                }
 472   1                      
 473   1                      len = strlen(sout1);
 474   1                      if(symb0 == symb1)
 475   1                      {       
 476   2                              for(i=0;i<len;i++) out[i]=sout1[i];
 477   2                      }
 478   1                      else
 479   1                      {
 480   2                              out[0]='-';                                                //Ìí¼Ó¸ººÅ
 481   2                              for(i=0;i<len;i++) out[i+1]=sout1[i];
 482   2                      }
 483   1              
 484   1      }
 485          
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 9   

 486          void dat_div(u8 symb0,u8 pot0,u8 s0[],u8 symb1,u8 pot1,u8 s1[],u8 out[])
 487          {
 488   1              char i=0;
 489   1              u8 len;
 490   1              u8 sout[15]=0;
 491   1              u8 ss[MAXN]=0;
 492   1      
 493   1              divx("1000000000000000",s1,ss);            //1e15
 494   1              len=strlen(ss);
 495   1              for(i=0;i<16-len;i++)sout[i]='0';
 496   1              strcat(sout,ss);                         //×Ö·û´®Ç°ÃæÌí¼Ó0£¬15Î»³¤¶È¶ÔÆë
 497   1              dat_mul(symb0,pot0,s0,symb1,15-pot1,sout,out); 
 498   1              
 499   1      }
 500          
 501          
 502          void display_ans(u8 *ans)
 503          {
 504   1              u8 len=0;
 505   1              u8 addr=0xC0;
 506   1              if(strstr(ans,"."))
 507   1              {
 508   2                      while(ans[len]!='.')len++;      
 509   2              }
 510   1              else 
 511   1              {
 512   2                      len = strlen(ans);
 513   2              }
 514   1                      if(len>16)
 515   1                      {
 516   2                              if(ans[0]=='-')
 517   2                              {
 518   3                                        LcdWriteCom(addr++);LcdWriteData(ans[0]);
 519   3                                              LcdWriteCom(addr++);LcdWriteData(ans[1]);
 520   3                                      LcdWriteCom(addr++);LcdWriteData('.');
 521   3                                              LcdWriteCom(addr++);LcdWriteData(ans[2]);
 522   3                                              LcdWriteCom(addr++);LcdWriteData(ans[3]);
 523   3                                              LcdWriteCom(addr++);LcdWriteData(ans[4]);
 524   3                                              LcdWriteCom(addr++);LcdWriteData(ans[5]);
 525   3                                              LcdWriteCom(addr++);LcdWriteData(ans[6]);
 526   3                                              LcdWriteCom(addr++);LcdWriteData(ans[7]);
 527   3                                              LcdWriteCom(addr++);LcdWriteData(ans[8]);
 528   3                                              LcdWriteCom(addr++);LcdWriteData(ans[9]);
 529   3                                              LcdWriteCom(addr++);LcdWriteData(ans[10]);
 530   3                                              LcdWriteCom(addr++);LcdWriteData(ans[11]);
 531   3                                              LcdWriteCom(addr++);LcdWriteData('e');
 532   3                                              LcdWriteCom(addr++);LcdWriteData((len-2)/10 + '0');
 533   3                                              LcdWriteCom(addr++);LcdWriteData((len-2)%10 + '0');     
 534   3                              }
 535   2                              else
 536   2                              {
 537   3                                              LcdWriteCom(addr++);LcdWriteData(ans[0]);
 538   3                                              LcdWriteCom(addr++);LcdWriteData('.');
 539   3                                              LcdWriteCom(addr++);LcdWriteData(ans[1]);
 540   3                                              LcdWriteCom(addr++);LcdWriteData(ans[2]);
 541   3                                              LcdWriteCom(addr++);LcdWriteData(ans[3]);
 542   3                                              LcdWriteCom(addr++);LcdWriteData(ans[4]);
 543   3                                              LcdWriteCom(addr++);LcdWriteData(ans[5]);
 544   3                                              LcdWriteCom(addr++);LcdWriteData(ans[6]);
 545   3                                              LcdWriteCom(addr++);LcdWriteData(ans[7]);
 546   3                                              LcdWriteCom(addr++);LcdWriteData(ans[8]);
 547   3                                              LcdWriteCom(addr++);LcdWriteData(ans[9]);
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 10  

 548   3                                              LcdWriteCom(addr++);LcdWriteData(ans[10]);
 549   3                                              LcdWriteCom(addr++);LcdWriteData(ans[11]);
 550   3                                              LcdWriteCom(addr++);LcdWriteData('e');
 551   3                                              LcdWriteCom(addr++);LcdWriteData((len-1)/10 + '0');
 552   3                                              LcdWriteCom(addr++);LcdWriteData((len-1)%10 + '0');     
 553   3                              }
 554   2                      }
 555   1                      else
 556   1                      {
 557   2                              LCD_ShowStr(1,ans);
 558   2                      }
 559   1              
 560   1      }
 561          
 562          
 563          void main()
 564          {
 565   1              char key=0;   //°´¼üÖµ
 566   1              u8 i;
 567   1        u8    cnt0 = 0,cnt1 = 0;          //ÓÃÓÚÏÔÊ¾µÄÊý¾Ý³¤¶È
 568   1              u8 dat_cnt0=0,dat_cnt1=0;      //ÓÃÓÚ¼ÆËãµÄÊý¾Ý³¤¶È
 569   1              u8 buf[MAXN]={0};
 570   1      
 571   1              u8 dat_flag = 0;
 572   1              u8 symbol=0;   //ÔËËã·ûºÅ
 573   1              
 574   1              u8 pot0_flag = 0;           //Ð¡ÊýµãÎ»ÖÃ
 575   1              u8 pot1_flag = 0;
 576   1              
 577   1              u8 neg0 = 0;               //Õý¸ººÅ
 578   1              u8 neg1 = 0;
 579   1              
 580   1              LcdInit();
 581   1              LCD_ShowStr(0,"welcome!!!!");
 582   1              delay(30000);
 583   1              LCD_ShowStr(0,"0          ");
 584   1              delay(30000);
 585   1              
 586   1      //      subx(data0,data1,buf);
 587   1      //      LCD_ShowStr(1,buf);
 588   1              
 589   1              while(1)
 590   1              {
 591   2                      //LCD_ShowStr(1,show0);
 592   2                              key=keyscan();    //»ñÈ¡°´¼üÖµ
 593   2                      if(key!=-1)          //ÓÐ°´¼ü°´ÏÂ
 594   2                      {
 595   3                              
 596   3                              
 597   3                                                                              if(key<12) //°´¼üÖµÎª 0123456789.
 598   3                                                                              {
 599   4                                                                                                      if(dat_flag==0)
 600   4                                                                                                      {
 601   5                                                                                                              
 602   5                                                                                                                    if(key == fuh && cnt0==0)
 603   5                                                                                                                                      {
 604   6                                                                                                                                              show0[cnt0++] = '-';
 605   6                                                                                                                                              neg0=1;
 606   6                                                                                                                                      }
 607   5                                                                                                                                      else if(key == pot)
 608   5                                                                                                                                      {
 609   6                                                                                                                                                                      if(strstr(show0,".")==0 && cnt0!=0)     //ÓÐÐ¡Êýµã²¢²»ÊÇÊý¾ÝµÚÒ»Î»
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 11  

 610   6                                                                                                                                                                      {
 611   7                                                                                                                                                                              show0[cnt0++] = '.';
 612   7                                                                                                                                                                      }
 613   6                                                                                                                                      }
 614   5                                                                                                                                      else if(key != fuh)
 615   5                                                                                                                                      {
 616   6                                                                                                                                              if(strstr(show0,"."))pot0_flag++;
 617   6                                                                                                                                                                      show0[cnt0++] = key + '0';
 618   6                                                                                                                                                                      data0[dat_cnt0++] = key + '0';
 619   6                                                                                                                                      }
 620   5                                                                                                                                      
 621   5                                                                                                                                      LCD_ShowStr(0,show0);
 622   5                                                                                                      }
 623   4                                                                                                      else
 624   4                                                                                                      {
 625   5                                                                                                                    if(key == fuh && cnt1==0)
 626   5                                                                                                                                      {
 627   6                                                                                                                                              show1[cnt1++] = '-';
 628   6                                                                                                                                              neg1=1;
 629   6                                                                                                                                      }
 630   5                                                                                                                                      else if(key == pot)
 631   5                                                                                                                                      {
 632   6                                                                                                                                                                      if(strstr(show1,".")==0 && cnt1!=0)     //ÓÐÐ¡Êýµã²¢²»ÊÇÊý¾ÝµÚÒ»Î»
 633   6                                                                                                                                                                      {
 634   7                                                                                                                                                                              show1[cnt1++] = '.';
 635   7                                                                                                                                                                      }
 636   6                                                                                                                                      }
 637   5                                                                                                                                      else if(key != fuh)
 638   5                                                                                                                                      {
 639   6                                                                                                                                                    if(strstr(show1,"."))pot1_flag++;
 640   6                                                                                                                                                                      show1[cnt1++] = key + '0';
 641   6                                                                                                                                                                      data1[dat_cnt1++] = key + '0';
 642   6                                                                                                                                      }
 643   5                                                                                                                                      
 644   5                                                                                                                                      LCD_ShowStr(1,show1);
 645   5                                                                                                      }
 646   4                                                                              }
 647   3                                                                              else if(key>12 && dat_cnt0>0)              //ÔËËã·ûºÅ°´ÏÂ²¢ÇÒÊý¾Ý0ÓÐÊý¾Ý
 648   3                                                                              {
 649   4                                                                                                              symbol = key;
 650   4                                                                                           switch(symbol)
 651   4                                                                                                       {
 652   5                                                                                                               case add:LcdWriteCom(0x8f);LcdWriteData('+');break;
 653   5                                                                                                         case sub:LcdWriteCom(0x8f);LcdWriteData('-');break;
 654   5                                                                                                               case mul:LcdWriteCom(0x8f);LcdWriteData('*');break;
 655   5                                                                                                               case div:LcdWriteCom(0x8f);LcdWriteData('/');break;
 656   5                                                                                                       }
 657   4                                                                                                              dat_flag = 1;                 //±íÊ¾¸ÃÊäÈëµÚ¶þ¸öÊýÁË
 658   4                                                                              }
 659   3                                                                              else if(key==equ && dat_cnt1>0)  
 660   3                                                                              {                       //°´ÏÂµÈÓÚ·ûºÅ
 661   4                                                                                                                      switch(symbol)
 662   4                                                                                                                      {
 663   5                                                                                                                              case add:dat_add(neg0,pot0_flag,data0,neg1,pot1_flag,data1,buf);break;
 664   5                                                                                                                              case sub:dat_sub(neg0,pot0_flag,data0,neg1,pot1_flag,data1,buf);break;
 665   5                                                                                                                              case mul:dat_mul(neg0,pot0_flag,data0,neg1,pot1_flag,data1,buf);break;
 666   5                                                                                                                              case div:dat_div(neg0,pot0_flag,data0,neg1,pot1_flag,data1,buf);break;
 667   5                                                                                                                      //      case sub:subx(data0,data1,buf);break;
 668   5                                                                                                                      //      case add:addx(data0,data1,buf);break;
 669   5                                                                                                                      //      case div:divx(data0,data1,buf,buf1);break;
 670   5                                                                                                                      }
 671   4                                                                                                                      LCD_ShowStr(0,"ans=            ");
C51 COMPILER V9.54   MAIN                                                                  06/22/2024 20:39:21 PAGE 12  

 672   4                                                                                                                      LCD_ShowStr(1,"                ");
 673   4                                                                                                                      display_ans(buf);
 674   4                                                                              }
 675   3                                                                                                      
 676   3                                                                                                      
 677   3                                                                                                      
 678   3                      }
 679   2                      if(key == clr)             //Çå³ý
 680   2                      {
 681   3                              for(i=0;i<MAXN;i++)show0[i]=0;
 682   3                              for(i=0;i<MAXN;i++)show1[i]=0;
 683   3                              for(i=0;i<MAXN;i++)data0[i]=0;
 684   3                              for(i=0;i<MAXN;i++)data1[i]=0;
 685   3                              for(i=0;i<MAXN;i++)buf[i]=0;
 686   3                              cnt0 = 0;cnt1 = 0;
 687   3                              dat_cnt0=0;dat_cnt1=0;
 688   3                              dat_flag = 0;
 689   3                              symbol=0;   
 690   3                              pot0_flag = 0;
 691   3                              pot1_flag = 0;
 692   3                        neg0 = 0;
 693   3                  neg1 = 0;
 694   3                              LCD_ShowStr(0,"0               ");
 695   3                              LCD_ShowStr(1,"                ");
 696   3                      }
 697   2              }
 698   1      }
 699          
 700          
 701          void LCD_ShowStr(char addr,char * str)
 702          {
 703   1              char i=0;
 704   1              if(addr == 0)LcdWriteCom(0x80);
 705   1              else if(addr == 1)LcdWriteCom(0xC0);
 706   1              while(*str != '\0')
 707   1              {
 708   2                      LcdWriteData(*str);
 709   2                      str++;
 710   2              }
 711   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  10908    ----
   CONSTANT SIZE    =    551    ----
   XDATA SIZE       =     64     606
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
